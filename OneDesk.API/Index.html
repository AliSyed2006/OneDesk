<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OneDesk Inventory</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #1e1e1e; color: #f1f1f1; font-family: 'Segoe UI', sans-serif; }
    h1, h4 { font-weight: 600; }
    .form-section, .actions { padding: 1.5rem; background-color: #2a2a2a; border-radius: 12px; margin-bottom: 2rem; }
    input, .form-control, .btn { border-radius: 8px !important; }
    .btn-light { background-color: #3c3c3c; color: #fff; border: none; }
    .btn-light:hover { background-color: #4b4b4b; }
    .output { white-space: pre-wrap; background: #111; padding: 1rem; border-radius: 10px; border: 1px solid #333; }
    a.btn:visited { color: #fff; }
    .btn-danger { background-color: #e74c3c; border-color: #e74c3c; }
    .btn-success { background-color: #27ae60; border-color: #27ae60; }
  </style>
</head>
<body class="container py-4">
  <h1 class="mb-4">OneDesk Inventory</h1>

  <!-- Add Item -->
  <div class="form-section">
    <h4>Add New Item</h4>
    <form id="addForm" class="row g-2">
      <div class="col-6"><input id="name"  class="form-control" placeholder="Name" required /></div>
      <div class="col-6"><input id="sku"   class="form-control" placeholder="SKU" required /></div>
      <div class="col-6"><input id="desc"  class="form-control" placeholder="Description" /></div>
      <div class="col-6"><input id="cat"   class="form-control" placeholder="Category" required /></div>
      <div class="col-6"><input id="sup"   class="form-control" placeholder="Supplier" /></div>
      <div class="col-4"><input id="qty"   type="number" class="form-control" placeholder="Stock" required /></div>
      <div class="col-4"><input id="cost"  type="number" class="form-control" placeholder="Cost Price" required /></div>
      <div class="col-4"><input id="sell"  type="number" class="form-control" placeholder="Selling Price" required /></div>
      <div class="col-12 text-end">
        <button class="btn btn-primary" type="submit">Add Item</button>
      </div>
    </form>
  </div>

  <!-- Record Sale -->
  <div class="form-section">
    <h4>Record Sale</h4>
    <form id="saleForm" class="row g-2">
      <div class="col-4"><input id="saleItemId" type="number" class="form-control" placeholder="Item ID" required /></div>
      <div class="col-4"><input id="saleQty" type="number" class="form-control" placeholder="Quantity Sold" required /></div>
      <div class="col-4"><input id="salePrice" type="number" class="form-control" placeholder="Selling Price (optional)" /></div>
      <div class="col-12 text-end">
        <button class="btn btn-danger" type="submit">Submit Sale</button>
      </div>
    </form>
  </div>

  <!-- Quick Actions -->
  <div class="actions">
    <h4>Quick Actions</h4>
    <button id="getAllBtn" class="btn btn-light me-2" type="button">Get All Items</button>
    <input id="getId" type="number" class="form-control d-inline-block w-auto me-1" placeholder="ID" />
    <button id="getBtn" class="btn btn-light me-2" type="button">Get Item by ID</button>
    <input id="delId" type="number" class="form-control d-inline-block w-auto me-1" placeholder="Delete ID" />
    <button id="delBtn" class="btn btn-danger me-2" type="button">Delete</button>
    <a href="#" id="downloadCsv" class="btn btn-success me-2">Download CSV</a>
    <a href="ai-assistant.html" class="btn btn-primary">üí¨ AI Assistant</a>
  </div>

  <!-- Output -->
  <div class="output" id="output">Responses appear here‚Ä¶</div>

  <script>
    const api = 'http://localhost:5062/api/Inventory';
    const salesApi = 'http://localhost:5062/api/Sales';
    const downloadUrl = 'http://localhost:5062/api/InventoryExport/download';
    const out = document.getElementById('output');

    document.getElementById('addForm').addEventListener('submit', async e => {
      e.preventDefault();
      const item = {
        name: val('name'),
        sku: val('sku'),
        description: val('desc'),
        category: val('cat'),
        supplier: val('sup'),
        quantityInStock: +val('qty'),
        costPrice: +val('cost'),
        sellingPrice: +val('sell'),
        createdAt: new Date().toISOString()
      };
      await call(api, 'POST', item);
    });

    document.getElementById('saleForm').addEventListener('submit', async e => {
      e.preventDefault();
      const sale = {
        inventoryItemId: +val('saleItemId'),
        quantitySold: +val('saleQty'),
        sellingPriceAtTime: +val('salePrice') || 0
      };
      await call(salesApi, 'POST', sale);
    });

    document.getElementById('getAllBtn').onclick = () => call(api, 'GET');
    document.getElementById('getBtn').onclick = () => {
      const id = val('getId');
      if (id) call(`${api}/${id}`, 'GET');
    };
    document.getElementById('delBtn').onclick = () => {
      const id = val('delId');
      if (id) call(`${api}/${id}`, 'DELETE');
    };
    document.getElementById('downloadCsv').onclick = e => {
      e.preventDefault();
      window.location = downloadUrl;
    };

    async function call(url, method, body) {
      try {
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: body ? JSON.stringify(body) : null
        });
        const text = await res.text();
        out.textContent = `${res.status} ${res.statusText}\n${text}`;
      } catch (err) {
        out.textContent = `‚ùå Error: ${err.message}`;
      }
    }

    function val(id) {
      return document.getElementById(id).value.trim();
    }
  </script>
</body>
</html>
